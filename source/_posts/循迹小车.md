---
title: 循迹小车
date: 2018-01-08 18:43:58
updated:
tags: [单片机,机器人]
categories: 机器人学院
keywords:
description: 大一上项目设计课程
top _img:
comments:
cover: http://photo.lyh.best/2021/03/09/1b8f4e6cb9780.jpeg
toc:
toc_number:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:
---

### 课程设计任务及评分标准
1.	课程设计按实验小组进行，为时三周，开始时间 2017 年 12 月 10日，结束时间 12 月 29日。考核时间为 2018 年 1 月 6 日（星期六）上午八点半，考核顺序抽签决定，抽签时间为 2018 年 1 月 5 日（星期五） 晚 7：30。 
2.	课程设计总分为 100 分，小车按要求完成指定各项功能的，可得满分为 95 分； 另外5 分作为小车速度加分。 
3.	小车依次经过 Figure1 标注 1 号点得 15 分、 2 号点再得 10 分， 3 号点再得 10分、 4 号点再得 10分、 5 号点再得 10 分、 6 号点再得 10 分、 7 号标注点再得 10 分、 8 号标注点得 10 分、 9 号标注点得 10 分， 一共95分；还有5分为时间上的加分，即小车能在50秒内完成路线的话，可得5分。 
4.	若为完成指定循迹，需在轨道上面做特殊标记的，可向核心教师团队申请，批准后可以在轨道上面做出特殊标记（每个小组仅允许作出一处特殊标记，标记不得使用总长度超过 250mm 的黑胶布）。对于在指定轨迹上做出标记的小组， 小车成绩扣 10 分。 
5.	每组在课程设计考核时，均有两次测试机会，以最好的一次成绩作为考核成绩。每次考核的用时为 70 秒，若超出 70 秒小车还没走完路线，则强制停止，以该停止点作为小车的终点并算分。 
6.	若在正式考核时两次测试均失败的小组，可提供课程设计期间调试循迹小车 完成情况最好的视频（该视频需值班老师或 TA 认证）给核心教师团队，核心教师团队根据认证视频给予评分， 小车总成绩扣除 25 分作为小车稳定性成绩失分。 
7.	小车在循迹过程中应跟随轨道，若脱离轨道，必须在 5 秒内返回到脱离轨道前的位置，否则判定此次测试结束；并以小车脱离轨道点为最终得分点计算得分。 
8.	若小车在循迹过程中进入岔道， 则此次测试成绩扣 5 分。每进入一个岔道扣5 分，直到此次考试结束。 
9.	小车须以轨道标记顺序依次经过各得分点，否则判定此次测试结束；只计算 按顺序经过的得分点分数。 
10.	考试时所用循迹小车必须为实验室提供的器件所搭建（部分特殊情况请联系TA 解决），否则不得参加考试。 
11.	循迹小车为机器人入门项目设计课程的期末考试，请各位认真对待。考试期间严禁使用通讯工具，发现违规者当场取消考试资格！ 
12.	考试时间为上午 8： 30 到中午 12:00，考核期间没有监考 TA 允许不得私自离开考场。考核结束的同学请耐心等候通知。 
13.	本次考核结束后请在下周（2018.1.10号）晚上八点前上交循迹小车报告（文件名以“第×组+姓名” 发到班长邮箱，并由班长打包整理好后发给 TA 教师团队。） 
14.	考核前可提出擦拭赛道的要求（避免有灰尘影响传感器灵敏度），但是不得破坏赛道。若发现违规者， 视赛道破坏情况扣除 5~25 分， 严重者直接取消考试资格！ 

### 附图
课程设计轨道如figure 1所示 ：
![image.png](http://photo.lyh.best/2021/03/09/5f682f0267020.png)

### 课程设计任务解决方案
#### 任务分析
循迹路线主要包括以下关卡:（岔道、平滑曲线、Y字型分岔、垂直岔道、断口、直角拐弯）
<table><tr>
<td><img src="http://photo.lyh.best/2021/03/09/3b502876f653e.png" alt="岔道" width="30%" height="30%"></td>
<td><img src="https://i.loli.net/2020/10/29/j3dp14RgkZHOnYJ.png" alt="平滑曲线" width="30%" height="30%"></td>
</tr>
<tr>
<td><img src="https://i.loli.net/2020/10/29/1DMdY5lL6WU9FnN.png" alt="Y字型分岔" width="30%" height="30%"></td>
<td><img src="https://i.loli.net/2020/10/29/KaCBvXcHwdn68Fm.png" alt="垂直岔道" width="30%" height="30%"></td>
</tr>
<tr>
<td><img src="https://i.loli.net/2020/10/29/RJsSChzM8nPk7pc.png" alt="断口" width="30%" height="30%"></td>
<td><img src="https://i.loli.net/2020/10/29/4LEiaY3rsxF2OKR.png" alt="直角拐弯" width="30%" height="30%"></td>
</tr></table>

#### 总体方案
本设计提出通过 用三个红外灰度传感器对路线进行识别，通过逻辑电路处理信号控制调整电机正反转以完成前进及转向功能，使小车能够按照规定的轨迹（黑线）完成直线、直角、弯道和岔道的转向运动并最终到达终点。

#### 核心逻辑
1. 将三个红外灰度传感器呈三角形排布：
![image.png](http://photo.lyh.best/2021/03/09/8f52049040f18.png)
2. 方法：分析关卡，探究在各关卡时三个红外灰度传感器分别的状态。依照各状态列出真值表以设计逻辑电路。
3. 真值表：（列出所有状况，1为检测到白色，0为检测到黑色）
<table>
   <tr><td>传感器A</td><td>传感器B</td><td>传感器C</td><td>左轮</td><td>右轮</td><td>左轮状态</td><td>右轮状态</td><td>小车状态</td></tr>
   <tr><td>1</td><td>1</td><td>0</td><td>1</td><td>1</td><td>快速正转</td><td>快速正转</td><td>快速前进</td></tr>
   <tr><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td><td>快速正转</td><td>快速正转</td><td>快速前进</td></tr>
   <tr><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>快速正转</td><td>快速正转</td><td>快速前进</td></tr>
   <tr><td>0</td><td>0</td><td>0</td><td>1</td><td>1</td><td>快速正转</td><td>快速正转</td><td>快速前进</td></tr>
   <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>快速正转</td><td>快速正转</td><td>快速前进</td></tr>
   <tr><td>1</td><td>0</td><td>1</td><td>1</td><td>0</td><td>快速正转</td><td>快速反转</td><td>右转</td></tr>
   <tr><td>0</td><td>1</td><td>1</td><td>0</td><td>1</td><td>快速反转</td><td>快速正转</td><td>左转</td></tr>
   <tr><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>快速反转</td><td>快速正转</td><td>左转</td></tr>
   <tr><td></td></tr>
</table>

4. 卡诺图
左：
<table>
   <tr><td>c\ab</td><td>00</td><td>01</td><td>11</td><td>10</td></tr>
   <tr><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
   <tr><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td></tr>
   <tr><td></td></tr>
</table>
右：
<table>
   <tr><td>c\ab</td><td>00</td><td>01</td><td>11</td><td>10</td></tr>
   <tr><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
   <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td></tr>
   <tr><td></td></tr>
</table>

5. 通过卡诺图化简后的逻辑：
左轮信号逻辑：$ L=\bar{C}+A $
右轮信号逻辑：$ R=\bar{C}+B+\bar{A} $

6. 逻辑电路：
![逻辑电路.png](http://photo.lyh.best/2021/03/09/6775f7256580c.png)
7. 通过逻辑电路对关卡的解决情况：
[1]在此点位时红外灰度传感器ABC将是001的状态，小车左转，避免进入右侧岔道。
![image.png](http://photo.lyh.best/2021/03/09/a296faf9d0bc4.png)
[2]	在此点位时红外灰度传感器ABC将是010的状态，小车保持直线行走，避免进入左侧岔道。
![image.png](http://photo.lyh.best/2021/03/09/fc95ae0d276eb.png)
[3]	在此点位时红外灰度传感器ABC将是011的状态，小车左转，通过左直角弯。（同理101时可转右直角弯）
![image.png](http://photo.lyh.best/2021/03/09/b1901a78ba059.png)
[4]	在此点位时红外灰度传感器ABC将是111的状态，小车保持直走，一直到通过终点结束。
![image.png](http://photo.lyh.best/2021/03/09/d244fdc871b9b.png)
8. 确认所需逻辑门元件：非门74ls04*1、或门74ls32*1。

#### 小车各部分电路
1. 芯片电源供电电路
通过lm1117稳压芯片将电压降到5v
![lm1117稳压芯片.png](http://photo.lyh.best/2021/03/09/3e146da986560.png)
2. PWM 信号产生电路
![PWM 信号产生电路.png](http://photo.lyh.best/2021/03/09/40a7e7f20081d.png)
3. 逻辑电路
![逻辑电路.png](http://photo.lyh.best/2021/03/09/eb39b1071fc54.png)
4. 电机驱动电路
![image.png](http://photo.lyh.best/2021/03/09/5b91a0cd1f0cd.png)

#### 搭建测试中遇到的问题及解决方案

[1]	两电机转速不一，无法正常直行，走线时摇摆剧烈，而且在关键关卡节点有较大几率出问题卡死或乱走。
解决方法：
1.	购买马达对电机内芯进行更换。
2.	加上电阻使转速较快一侧的轮子慢下来。（但由于实验室中可变电阻的调节精度太差难以调整到最佳状态，而且也浪费了电能）

[2]	过直角弯时会冲出赛道，原因是小车速度太快，传感器不够灵敏，逻辑反应不过来。红外灰度传感器C还在黑线内，两侧的传感器A和B不能输出有效信号，且车轮反转速度不够快，导致小车冲出赛道。
解决方法：
1.	将传感器C往前移动，提前感知弯道。（距两侧传感器连线约2.5cm）
2.	调整方波占空比，使车轮反转速度与正转基本一致，使小车转向速度加快。
3.	输入更低供电电压，使小车整体行进速度降低。

[3]	电压高于9v时，部分逻辑电路失效，无法完成逻辑运算。
解决方法：
1.	部分逻辑门芯片的输入电压高于5v后无法辨别高低电平，由稳压芯片LM1117输出稳定5v电压供给所有逻辑电路芯片。

### 视频
<video src="http://photo.lyh.best/2021/03/09/fe48e532490c9.mp4" alt="小车竞赛.mp4" width="100%" height="100%" controls="controls"></video>
<video src="http://photo.lyh.best/2021/03/09/1b671f0825d45.mp4" alt="小车竞赛.mp4" width="100%" height="100%" controls="controls"></video>


### 参考文献
[1]张宝荣.数字电子技术基础（第二版）[M].北京：电子工业出版社，2015：1-38.
[2]初永丽，王雪琪，范丽杰. 模拟电子技术基础 [M].西安: 西安电子科技大学出版社, 2016:
